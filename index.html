<!DOCTYPE html>
<html>
<head>
<title>Dispatch Pending</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="refresh" content="180">

<style>
body{margin:0;font-family:Arial;background:black;color:white;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px;}
h1{font-size:40px;}
#totalQty{font-size:28px;color:lightgreen;}

table{width:95%;margin:auto;border-collapse:collapse;font-size:20px;}
th,td{border:2px solid white;padding:6px;text-align:center;}
th{background:#333;}

.overdue{background:red;animation:blink 1.2s infinite;}
@keyframes blink{50%{opacity:0.4;}}

#wrap{height:55vh;overflow:hidden;}
#scroll{animation:scrollUp 240s linear infinite;}
@keyframes scrollUp{
  0%{transform:translateY(100%);}
  100%{transform:translateY(-100%);}
}

#summary{padding:15px;font-size:18px;}
</style>

<script>
const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vT04b2M0n-rrLlRUMu6JFJP5dxHBSQ8-4m45W47nxwwLUBDs1INcHO6jswUCnk3kp57AP3tQq19qccF/pub?output=csv";

function parseCSV(text){
  const rows=[], row=[];
  let q=false, c="";
  for(let i=0;i<text.length;i++){
    const ch=text[i];
    if(ch=='"') q=!q;
    else if(ch==','&&!q){row.push(c);c="";}
    else if(ch=='\n'&&!q){row.push(c);rows.push([...row]);row.length=0;c="";}
    else c+=ch;
  }
  if(c) row.push(c);
  if(row.length) rows.push(row);
  return rows;
}

function parseDate(v){
  if(!v) return null;
  const p=v.trim().split("-");
  if(p.length!=2) return null;
  const d=parseInt(p[0]);
  const m=new Date(Date.parse(p[1]+" 1, 2024")).getMonth();
  return new Date(new Date().getFullYear(),m,d);
}

fetch(sheetURL).then(r=>r.text()).then(t=>{
  const d=parseCSV(t.trim()); d.shift();
  let total=0, sum={}, rows=[];
  const today=new Date(); today.setHours(0,0,0,0);

  d.forEach(r=>{
    const qty
